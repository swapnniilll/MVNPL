<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <title>Add Item</title>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }
        .container {
            margin-top: 50px;
        }
        .required-textbox {
            display: none; /* Initially hidden */
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-center text-dark font-weight-bold">INDENT ADD ITEM</h1>
    <form id="itemForm">
        <div class="form-group">
            <label for="itemCode">Item Code</label>
            <input type="text" class="form-control" id="itemCode" readonly>
        </div>
        <div class="form-group">
            <label for="itemOption">Item Description List</label>
            <select class="form-control" id="itemOption">
                <option value="Mobile">Mobile</option>
                <option value="Watch">Watch</option>
                <option value="Lights">Lights</option>
            </select>
        </div>
        <div class="form-group">
            <label for="newItemDescription">Add New Item in Description List</label>
            <div class="input-group">
                <input type="text" class="form-control w-75" id="newItemDescription" placeholder="Enter new item description">
                <div class="input-group-append">
                    <button type="button" class="btn btn-primary ml-3" onclick="addItem()">Add Item</button>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="itemDescription">Item Description</label>
            <input type="text" class="form-control" id="itemDescription" required>
        </div>
        <div class="form-group">
            <label for="umo">UMO</label>
            <select class="form-control" id="umo">
                <option value="LIT">LIT</option>
                <option value="KG">KG</option>
                <option value="MT">MT</option>
                <option value="INCH">INCH</option>
                <option value="FT">FT</option>
                <option value="MG">MG</option>
            </select>
        </div>
        <div class="form-group">
            <label for="quantityRequired">Quantity Required</label>
            <input type="number" class="form-control" id="quantityRequired" required>
        </div>
        <div class="form-group">
            <label for="population">Population</label>
            <input type="number" class="form-control" id="population" required>
        </div>
        <div class="form-group">
            <label for="purchaseQuantity">Purchase Quantity Till Date</label>
            <input type="date" class="form-control" id="purchaseQuantity">
        </div>
        <div class="form-group">
            <label for="issuedQuantity">Issued Quantity Till Date</label>
            <input type="date" class="form-control" id="issuedQuantity">
        </div>
        <div class="form-group">
            <label for="stockPosition">Stock Position</label>
            <select class="form-control" id="stockPosition" onchange="toggleRequiredTextbox()">
                <option value="Nill">Nill</option>
                <option value="Required">Required</option>
            </select>
            <input type="text" class="form-control required-textbox" id="requiredTextbox" placeholder="Enter details here">
        </div>
        <div class="form-group">
            <label for="lastPurchasePrice">Last Purchase Price</label>
            <input type="number" class="form-control" id="lastPurchasePrice" required>
        </div>
        <div class="form-group">
            <label for="lastPurchaseDate">Last Purchase Date</label>
            <input type="date" class="form-control" id="lastPurchaseDate">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
        <button type="#" class="btn btn-primary ml-5">Upload</button>
    </form>

    <script>
        // Function to toggle the visibility of the required textbox
        function toggleRequiredTextbox() {
            var stockPosition = document.getElementById("stockPosition").value;
            var requiredTextbox = document.getElementById("requiredTextbox");
            if (stockPosition === "Required") {
                requiredTextbox.style.display = "block"; // Show textbox
            } else {
                requiredTextbox.style.display = "none"; // Hide textbox
            }
        }

        // Function to add a new item to the description list
        function addItem() {
            const newItemDescription = document.getElementById('newItemDescription').value;
            const itemOption = document.getElementById('itemOption');
            const newOption = document.createElement('option');
            newOption.value = newItemDescription;
            newOption.text = newItemDescription;
            itemOption.add(newOption);
            document.getElementById('newItemDescription').value = '';
        }

        // Retrieve the current item code from local storage
        let currentCode = localStorage.getItem('currentCode');
        if (!currentCode) {
            currentCode = 0;
        } else {
            currentCode = parseInt(currentCode);
        }

        // Generate the initial item code
        const itemCode = `ITEM-${String(currentCode).padStart(4, '0')}`;
        document.getElementById('itemCode').value = itemCode;

        document.getElementById('itemForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent form submission

            // Increment the current item code
            currentCode += 1;
            localStorage.setItem('currentCode', currentCode);

            // Generate the new item code
            const newItemCode = `ITEM-${String(currentCode).padStart(4, '0')}`;
            document.getElementById('itemCode').value = newItemCode;

            // Get form values
            const itemOption = document.getElementById('itemOption').value;
            const itemDescription = document.getElementById('itemDescription').value;
            const umo = document.getElementById('umo').value;
            const quantityRequired = document.getElementById('quantityRequired').value;
            const population = document.getElementById('population').value;
            const purchaseQuantity = document.getElementById('purchaseQuantity').value;
            const issuedQuantity = document.getElementById('issuedQuantity').value;
            const stockPosition = document.getElementById('stockPosition').value;
            let stockPositionValue;
            if (stockPosition === "Required") {
                stockPositionValue = document.getElementById('requiredTextbox').value;
            } else {
                stockPositionValue = stockPosition;
            }
            const lastPurchasePrice = document.getElementById('lastPurchasePrice').value;
            const lastPurchaseDate = document.getElementById('lastPurchaseDate').value;

            // Save data to local storage
            localStorage.setItem('itemData', JSON.stringify({
                itemCode: newItemCode,
                itemOption,
                itemDescription,
                umo,
                quantityRequired,
                population,
                purchaseQuantity,
                issuedQuantity,
                stockPositionValue,
                lastPurchasePrice,
                lastPurchaseDate
            }));

            // Redirect to the new HTML page
            window.location.href = 'table.html';
        });
    </script>

</body>
</html>